Only in iris/include/: .svn
Only in iris/include/: CMakeLists.txt
Only in iris/include/: empty.cpp
diff -u /home/kde4/psi/psi/iris/include/im.h iris/include/im.h
--- /home/kde4/psi/psi/iris/include/im.h	2006-07-31 15:49:03.000000000 +0200
+++ iris/include/im.h	2006-07-31 18:23:40.000000000 +0200
@@ -26,9 +26,11 @@
 #include <QList>
 #include "xmpp.h"
 
+#include <iris_export.h>
+
 namespace XMPP
 {
-	class Url
+	class IRIS_EXPORT Url
 	{
 	public:
 		Url(const QString &url="", const QString &desc="");
@@ -83,7 +85,7 @@
 	typedef QList<Address> AddressList;
 	typedef QMap<QString, QString> StringMap;
 	typedef enum { OfflineEvent, DeliveredEvent, DisplayedEvent,
-			ComposingEvent, CancelEvent } MsgEvent;
+			ComposingEvent, CancelEvent, InactiveEvent, GoneEvent } MsgEvent;
 	typedef enum { StateNone, StateActive, StateComposing, StatePaused, 
 			StateInactive, StateGone } ChatState;
 	
@@ -356,7 +358,7 @@
 		Private *d;
 	};
 
-	class Subscription
+	class IRIS_EXPORT Subscription
 	{
 	public:
 		enum SubType { None, To, From, Both, Remove };
@@ -372,7 +374,7 @@
 		SubType value;
 	};
 
-	class Status
+	class IRIS_EXPORT Status
 	{
 	public:
 		Status(const QString &show="", const QString &status="", int priority=0, bool available=true);
@@ -462,7 +464,7 @@
 		QString estr;
 	};
 
-	class Resource
+	class IRIS_EXPORT Resource
 	{
 	public:
 		Resource(const QString &name="", const Status &s=Status());
@@ -480,7 +482,7 @@
 		Status v_status;
 	};
 
-	class ResourceList : public QList<Resource>
+	class IRIS_EXPORT ResourceList : public QList<Resource>
 	{
 	public:
 		ResourceList();
@@ -493,7 +495,7 @@
 		ResourceList::ConstIterator priority() const;
 	};
 
-	class RosterItem
+	class IRIS_EXPORT RosterItem
 	{
 	public:
 		RosterItem(const Jid &jid="");
@@ -528,7 +530,7 @@
 		bool v_push;
 	};
 
-	class Roster : public QList<RosterItem>
+	class IRIS_EXPORT Roster : public QList<RosterItem>
 	{
 	public:
 		Roster();
@@ -541,7 +543,7 @@
 		class RosterPrivate *d;
 	};
 
-        class Features
+        class IRIS_EXPORT Features
 	{
 	public:
 		Features();
@@ -562,6 +564,7 @@
 		bool canDisco() const;
 		bool canChatState() const;
 		bool canCommand() const;
+		bool canXHTML() const;
 		bool isGateway() const;
 		bool haveVCard() const;
 
@@ -575,6 +578,7 @@
 			FID_Gateway,
 			FID_VCard,
 			FID_AHCommand,
+			FID_Xhtml,
 
 			// private Psi actions
 			FID_Add
@@ -596,7 +600,7 @@
 		QStringList _list;
 	};
 
-	class AgentItem
+	class IRIS_EXPORT AgentItem
 	{
 	public:
 		AgentItem() { }
@@ -621,7 +625,7 @@
 
 	typedef QList<AgentItem> AgentList;
 
-	class DiscoItem
+	class IRIS_EXPORT DiscoItem
 	{
 	public:
 		DiscoItem();
@@ -677,7 +681,7 @@
 
 	typedef QList<DiscoItem> DiscoList;
 
-	class FormField
+	class IRIS_EXPORT FormField
 	{
 	public:
 		enum { username, nick, password, name, first, last, email, address, city, state, zip, phone, url, date, misc };
@@ -704,7 +708,7 @@
 		Private *d;
 	};
 
-	class Form : public QList<FormField>
+	class IRIS_EXPORT Form : public QList<FormField>
 	{
 	public:
 		Form(const Jid &j="");
@@ -725,7 +729,7 @@
 		Private *d;
 	};
 
-	class SearchResult
+	class IRIS_EXPORT SearchResult
 	{
 	public:
 		SearchResult(const Jid &jid="");
@@ -756,7 +760,7 @@
 	class JidLinkManager;
 	class FileTransferManager;
 
-	class Task : public QObject
+	class IRIS_EXPORT Task : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -803,7 +807,7 @@
 		TaskPrivate *d;
 	};
 
-	class Client : public QObject
+	class IRIS_EXPORT Client : public QObject
 	{
 		Q_OBJECT
 
@@ -938,7 +942,7 @@
 		ClientPrivate *d;
 	};
 
-	class LiveRosterItem : public RosterItem
+	class IRIS_EXPORT LiveRosterItem : public RosterItem
 	{
 	public:
 		LiveRosterItem(const Jid &j="");
@@ -966,7 +970,7 @@
 		bool v_flagForDelete;
 	};
 
-	class LiveRoster : public QList<LiveRosterItem>
+	class IRIS_EXPORT LiveRoster : public QList<LiveRosterItem>
 	{
 	public:
 		LiveRoster();
Only in iris/include/: im.h.rej
Only in iris/include/: im.h~
diff -u /home/kde4/psi/psi/iris/include/xmpp.h iris/include/xmpp.h
--- /home/kde4/psi/psi/iris/include/xmpp.h	2006-07-31 15:49:01.000000000 +0200
+++ iris/include/xmpp.h	2006-07-31 17:42:40.000000000 +0200
@@ -30,6 +30,8 @@
 #include <qxml.h>
 #include <qdom.h>
 
+#include <iris_export.h>
+
 namespace QCA
 {
 	class TLS;
@@ -63,7 +65,7 @@
 
 	void setDebug(Debug *);
 
-	class Connector : public QObject
+	class IRIS_EXPORT Connector : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -95,7 +97,7 @@
 		Q_UINT16 port;
 	};
 
-	class AdvancedConnector : public Connector
+	class IRIS_EXPORT AdvancedConnector : public Connector
 	{
 		Q_OBJECT
 	public:
@@ -169,7 +171,7 @@
 		void tryNextSrv();
 	};
 
-	class TLSHandler : public QObject
+	class IRIS_EXPORT TLSHandler : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -189,7 +191,7 @@
 		void readyReadOutgoing(const QByteArray &a, int plainBytes);
 	};
 
-	class QCATLSHandler : public TLSHandler
+	class IRIS_EXPORT QCATLSHandler : public TLSHandler
 	{
 		Q_OBJECT
 	public:
@@ -222,7 +224,7 @@
 		Private *d;
 	};
 
-	class Jid
+	class IRIS_EXPORT Jid
 	{
 	public:
 		Jid();
@@ -271,7 +273,7 @@
 	};
 
 	class Stream;
-	class Stanza
+	class IRIS_EXPORT Stanza
 	{
 	public:
 		enum Kind { Message, Presence, IQ };
@@ -370,7 +372,7 @@
 		Private *d;
 	};
 
-	class Stream : public QObject
+	class IRIS_EXPORT Stream : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -416,7 +418,7 @@
 		void error(int);
 	};
 
-	class ClientStream : public Stream
+	class IRIS_EXPORT ClientStream : public Stream
 	{
 		Q_OBJECT
 	public:
Only in iris/include/: xmpp.h~
Only in iris/jabber/: .svn
Only in iris/jabber/: CMakeLists.txt
Only in iris/jabber/: all_mocs.cpp
diff -u /home/kde4/psi/psi/iris/jabber/filetransfer.cpp iris/jabber/filetransfer.cpp
--- /home/kde4/psi/psi/iris/jabber/filetransfer.cpp	2006-07-31 15:48:42.000000000 +0200
+++ iris/jabber/filetransfer.cpp	2006-07-31 17:41:52.000000000 +0200
@@ -756,3 +756,5 @@
 	incoming(r);
 	return true;
 }
+
+#include "filetransfer.moc"
diff -u /home/kde4/psi/psi/iris/jabber/filetransfer.h iris/jabber/filetransfer.h
--- /home/kde4/psi/psi/iris/jabber/filetransfer.h	2006-07-31 15:48:42.000000000 +0200
+++ iris/jabber/filetransfer.h	2006-07-31 17:42:40.000000000 +0200
@@ -28,7 +28,7 @@
 	class S5BConnection;
 	struct FTRequest;
 
-	class FileTransfer : public QObject
+	class IRIS_EXPORT FileTransfer : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -85,7 +85,7 @@
 		void takeConnection(S5BConnection *c);
 	};
 
-	class FileTransferManager : public QObject
+	class IRIS_EXPORT FileTransferManager : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -116,7 +116,7 @@
 		void unlink(FileTransfer *);
 	};
 
-	class JT_FT : public Task
+	class IRIS_EXPORT JT_FT : public Task
 	{
 		Q_OBJECT
 	public:
diff -u /home/kde4/psi/psi/iris/jabber/s5b.h iris/jabber/s5b.h
--- /home/kde4/psi/psi/iris/jabber/s5b.h	2006-07-31 15:48:42.000000000 +0200
+++ iris/jabber/s5b.h	2006-07-31 17:42:40.000000000 +0200
@@ -42,7 +42,7 @@
 	typedef Q3PtrList<S5BConnection> S5BConnectionList;
 	typedef Q3PtrListIterator<S5BConnection> S5BConnectionListIt;
 
-	class S5BDatagram
+	class IRIS_EXPORT S5BDatagram
 	{
 	public:
 		S5BDatagram();
@@ -57,7 +57,7 @@
 		QByteArray _buf;
 	};
 
-	class S5BConnection : public ByteStream
+	class IRIS_EXPORT S5BConnection : public ByteStream
 	{
 		Q_OBJECT
 	public:
@@ -127,7 +127,7 @@
 		S5BConnection(S5BManager *, QObject *parent=0);
 	};
 
-	class S5BManager : public QObject
+	class IRIS_EXPORT S5BManager : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -196,7 +196,7 @@
 		void doActivate(const Jid &peer, const QString &sid, const Jid &streamHost);
 	};
 
-	class S5BConnector : public QObject
+	class IRIS_EXPORT S5BConnector : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -227,7 +227,7 @@
 	};
 
 	// listens on a port for serving
-	class S5BServer : public QObject
+	class IRIS_EXPORT S5BServer : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -260,7 +260,7 @@
 		void writeUDP(const QHostAddress &addr, int port, const QByteArray &data);
 	};
 
-	class JT_S5B : public Task
+	class IRIS_EXPORT JT_S5B : public Task
 	{
 		Q_OBJECT
 	public:
@@ -286,7 +286,7 @@
 		Private *d;
 	};
 
-	struct S5BRequest
+	struct IRIS_EXPORT S5BRequest
 	{
 		Jid from;
 		QString id, sid;
@@ -294,7 +294,7 @@
 		bool fast;
 		bool udp;
 	};
-	class JT_PushS5B : public Task
+	class IRIS_EXPORT JT_PushS5B : public Task
 	{
 		Q_OBJECT
 	public:
@@ -316,7 +316,7 @@
 		void incomingActivate(const Jid &from, const QString &sid, const Jid &streamHost);
 	};
 
-	class StreamHost
+	class IRIS_EXPORT StreamHost
 	{
 	public:
 		StreamHost();
diff -u /home/kde4/psi/psi/iris/jabber/xmpp_ibb.cpp iris/jabber/xmpp_ibb.cpp
--- /home/kde4/psi/psi/iris/jabber/xmpp_ibb.cpp	2006-07-31 15:48:41.000000000 +0200
+++ iris/jabber/xmpp_ibb.cpp	2006-07-31 17:41:52.000000000 +0200
@@ -636,3 +636,4 @@
 	return d->mode;
 }
 
+#include "xmpp_ibb.moc"
diff -u /home/kde4/psi/psi/iris/jabber/xmpp_ibb.h iris/jabber/xmpp_ibb.h
--- /home/kde4/psi/psi/iris/jabber/xmpp_ibb.h	2006-07-31 15:48:41.000000000 +0200
+++ iris/jabber/xmpp_ibb.h	2006-07-31 17:42:40.000000000 +0200
@@ -34,7 +34,7 @@
 	class IBBManager;
 
 	// this is an IBB connection.  use it much like a qsocket
-	class IBBConnection : public ByteStream
+	class IRIS_EXPORT IBBConnection : public ByteStream
 	{
 		Q_OBJECT
 	public:
@@ -78,7 +78,7 @@
 
 	typedef Q3PtrList<IBBConnection> IBBConnectionList;
 	typedef Q3PtrListIterator<IBBConnection> IBBConnectionListIt;
-	class IBBManager : public QObject
+	class IRIS_EXPORT IBBManager : public QObject
 	{
 		Q_OBJECT
 	public:
@@ -111,7 +111,7 @@
 		void doReject(IBBConnection *c, const QString &id, int, const QString &);
 	};
 
-	class JT_IBB : public Task
+	class IRIS_EXPORT JT_IBB : public Task
 	{
 		Q_OBJECT
 	public:
Only in iris/jabber/: xmpp_jidlink.cpp
Only in iris/jabber/: xmpp_jidlink.cpp.rej
Only in iris/jabber/: xmpp_jidlink.h
Only in iris/jabber/: xmpp_jidlink.h.rej
Only in iris/xmpp-im/: .svn
Only in iris/xmpp-im/: CMakeLists.txt
diff -u /home/kde4/psi/psi/iris/xmpp-im/types.cpp iris/xmpp-im/types.cpp
--- /home/kde4/psi/psi/iris/xmpp-im/types.cpp	2006-07-31 15:49:03.000000000 +0200
+++ iris/xmpp-im/types.cpp	2006-07-31 18:24:53.000000000 +0200
@@ -24,6 +24,7 @@
 #include <qapplication.h>
 //Added by qt3to4:
 #include <QList>
+#include "protocol.h"
 
 #define NS_XML     "http://www.w3.org/XML/1998/namespace"
 
@@ -1473,28 +1474,48 @@
 			else
 				x.appendChild(s.createTextElement("jabber:x:event","id",d->eventId));
 		}
+		else if (d->type=="chat" || d->type=="groupchat")
+			s.appendChild(  s.createElement(NS_CHATSTATES , "active" ) );
 
+		bool need_x_event=false;
 		for(QList<MsgEvent>::ConstIterator ev = d->eventList.begin(); ev != d->eventList.end(); ++ev) {
 			switch (*ev) {
 				case OfflineEvent:
 					x.appendChild(s.createElement("jabber:x:event", "offline"));
+					need_x_event=true;
 					break;
 				case DeliveredEvent:
 					x.appendChild(s.createElement("jabber:x:event", "delivered"));
+					need_x_event=true;
 					break;
 				case DisplayedEvent:
 					x.appendChild(s.createElement("jabber:x:event", "displayed"));
+					need_x_event=true;
 					break;
 				case ComposingEvent: 
 					x.appendChild(s.createElement("jabber:x:event", "composing"));
+					need_x_event=true;
+					if (d->body.isEmpty() && (d->type=="chat" || d->type=="groupchat") )
+						s.appendChild(  s.createElement(NS_CHATSTATES , "composing" ) ); 
 					break;
 				case CancelEvent:
-					// Add nothing
+					need_x_event=true;
+					if (d->body.isEmpty() && (d->type=="chat" || d->type=="groupchat") )
+						s.appendChild(  s.createElement(NS_CHATSTATES , "paused" ) ); 
 					break;
-			}
-		}
-		s.appendChild(x);
-	} 
+				case InactiveEvent:
+					if (d->body.isEmpty() && (d->type=="chat" || d->type=="groupchat") )
+						s.appendChild(  s.createElement(NS_CHATSTATES , "inactive" ) ); 
+					break;
+				case GoneEvent:
+					if (d->body.isEmpty() && (d->type=="chat" || d->type=="groupchat") )
+						s.appendChild(  s.createElement(NS_CHATSTATES , "gone" ) ); 
+					break;
+  			}
+  		}
+		if(need_x_event)  //we don't need to have the (empty) x:event element if this is only <gone> or <inactive>
+			s.appendChild(x);
+	}
 
 	// chat state
 	QString chatStateNS = "http://jabber.org/protocol/chatstates";
@@ -1589,6 +1610,7 @@
 	d->body.clear();
 	d->htmlElements.clear();
 	d->thread = QString();
+	d->eventList.clear();
 
 	QDomElement root = s.element();
 
@@ -1629,6 +1651,33 @@
 					}
 				}
 			}
+			else if (e.namespaceURI() == NS_CHATSTATES)
+			{
+				if(e.tagName() == "active")
+				{
+					//like in JEP-0022  we let the client know that we can receive ComposingEvent
+					// (we can do that according to  §4.6  of the JEP-0085)
+					d->eventList += ComposingEvent;
+					d->eventList += InactiveEvent;
+					d->eventList += GoneEvent;
+				}
+				else if (e.tagName() == "composing")
+				{
+					d->eventList += ComposingEvent;
+				}
+				else if (e.tagName() == "paused")
+				{
+					d->eventList += CancelEvent;
+				}
+				else if (e.tagName() == "inactive")
+				{
+					d->eventList += InactiveEvent;
+				}
+				else if (e.tagName() == "gone")
+				{
+					d->eventList += GoneEvent;
+				}
+			}
 			else {
 				//printf("extension element: [%s]\n", e.tagName().latin1());
 			}
@@ -1675,7 +1724,6 @@
 	}
 	
     // events
-	d->eventList.clear();
 	nl = root.elementsByTagNameNS("jabber:x:event", "x");
 	if (nl.count()) {
 		nl = nl.item(0).childNodes();
@@ -1690,6 +1738,8 @@
 				d->eventList += ComposingEvent;
 			else if (evtag == "delivered")
 				d->eventList += DeliveredEvent;
+			else if (evtag == "offline")
+				d->eventList += OfflineEvent;
 		}
 		if (d->eventList.isEmpty())
 			d->eventList += CancelEvent;
@@ -2732,6 +2782,14 @@
 	return test(ns);
 }
 
+#define FID_XHTML  "http://jabber.org/protocol/xhtml-im"
+bool Features::canXHTML() const
+{
+	QStringList ns;
+	ns << FID_XHTML;
+	return test(ns);
+}
+
 #define FID_GATEWAY "jabber:iq:gateway"
 bool Features::isGateway() const
 {
Only in iris/xmpp-im/: types.cpp.rej
Only in iris/xmpp-im/: types.cpp~
diff -u /home/kde4/psi/psi/iris/xmpp-im/xmpp_tasks.cpp iris/xmpp-im/xmpp_tasks.cpp
--- /home/kde4/psi/psi/iris/xmpp-im/xmpp_tasks.cpp	2006-07-31 15:49:02.000000000 +0200
+++ iris/xmpp-im/xmpp_tasks.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -873,6 +873,74 @@
 
 
 //----------------------------------------------------------------------------
+// JT_GetLastActivity
+//----------------------------------------------------------------------------
+class JT_GetLastActivity::Private
+{
+public:
+	Private() {}
+
+	int seconds;
+	QString message;
+};
+
+JT_GetLastActivity::JT_GetLastActivity(Task *parent)
+:Task(parent)
+{
+	d = new Private;
+}
+
+JT_GetLastActivity::~JT_GetLastActivity()
+{
+	delete d;
+}
+
+void JT_GetLastActivity::get(const Jid &j)
+{
+	jid = j;
+	iq = createIQ(doc(), "get", jid.full(), id());
+	QDomElement query = doc()->createElement("query");
+	query.setAttribute("xmlns", "jabber:iq:last");
+	iq.appendChild(query);
+}
+
+int JT_GetLastActivity::seconds() const
+{
+	return d->seconds;
+}
+
+const QString &JT_GetLastActivity::message() const
+{
+	return d->message;
+}
+
+void JT_GetLastActivity::onGo()
+{
+	send(iq);
+}
+
+bool JT_GetLastActivity::take(const QDomElement &x)
+{
+	if(!iqVerify(x, jid, id()))
+		return false;
+
+	if(x.attribute("type") == "result") {
+		QDomElement q = queryTag(x);
+
+		d->message = q.text();
+		bool ok;
+		d->seconds = q.attribute("seconds").toInt(&ok);
+
+		setSuccess(ok);
+	}
+	else {
+		setError(x);
+	}
+
+	return true;
+}
+
+//----------------------------------------------------------------------------
 // JT_GetServices
 //----------------------------------------------------------------------------
 JT_GetServices::JT_GetServices(Task *parent)
@@ -1423,6 +1491,10 @@
 				query.appendChild(feature);
 			}
 
+			feature = doc()->createElement("feature");
+			feature.setAttribute("var", "http://jabber.org/protocol/xhtml-im");
+			query.appendChild(feature);
+
 			if (node.isEmpty()) {
 				// Extended features
 				QStringList exts = client()->extensions();
@@ -1977,3 +2049,95 @@
 	return true;
 }
 
+
+
+
+//----------------------------------------------------------------------------
+// JT_PrivateStorage
+//----------------------------------------------------------------------------
+class JT_PrivateStorage::Private
+{
+	public:
+		Private() : type(-1) {}
+
+		QDomElement iq;
+		QDomElement elem;
+		int type;
+};
+
+JT_PrivateStorage::JT_PrivateStorage(Task *parent)
+	:Task(parent)
+{
+	d = new Private;
+}
+
+JT_PrivateStorage::~JT_PrivateStorage()
+{
+	delete d;
+}
+
+void JT_PrivateStorage::get(const QString& tag, const QString& xmlns)
+{
+	d->type = 0;
+	d->iq = createIQ(doc(), "get" , QString() , id() );
+	QDomElement query = doc()->createElement("query");
+	query.setAttribute("xmlns", "jabber:iq:private");
+	d->iq.appendChild(query);
+	QDomElement s = doc()->createElement(tag);
+	if(!xmlns.isEmpty())
+		s.setAttribute("xmlns", xmlns);
+	query.appendChild(s);
+}
+
+void JT_PrivateStorage::set(const QDomElement& element)
+{
+	d->type = 1;
+	d->elem=element;
+	QDomNode n=doc()->importNode(element,true);
+
+	d->iq = createIQ(doc(), "set" , QString() , id() );
+	QDomElement query = doc()->createElement("query");
+	query.setAttribute("xmlns", "jabber:iq:private");
+	d->iq.appendChild(query);
+	query.appendChild(n);
+}
+
+void JT_PrivateStorage::onGo()
+{
+	send(d->iq);
+}
+
+bool JT_PrivateStorage::take(const QDomElement &x)
+{
+	QString to = client()->host();
+	if(!iqVerify(x, to, id()))
+		return false;
+
+	if(x.attribute("type") == "result") {
+		if(d->type == 0) {
+			QDomElement q = queryTag(x);
+			for(QDomNode n = q.firstChild(); !n.isNull(); n = n.nextSibling()) {
+				QDomElement i = n.toElement();
+				if(i.isNull())
+					continue;
+				d->elem=i;
+				break;
+			}
+		}
+		setSuccess();
+		return true;
+	}
+	else {
+		setError(x);
+	}
+
+	return true;
+}
+
+
+QDomElement JT_PrivateStorage::element( )
+{
+	return d->elem;
+}
+
+#include "xmpp_tasks.moc"
Only in iris/xmpp-im/: xmpp_tasks.cpp.rej
Only in iris/xmpp-im/: xmpp_tasks.cpp~
diff -u /home/kde4/psi/psi/iris/xmpp-im/xmpp_tasks.h iris/xmpp-im/xmpp_tasks.h
--- /home/kde4/psi/psi/iris/xmpp-im/xmpp_tasks.h	2006-07-31 15:49:02.000000000 +0200
+++ iris/xmpp-im/xmpp_tasks.h	2006-07-31 17:42:45.000000000 +0200
@@ -34,7 +34,7 @@
 	class Roster;
 	class Status;
 
-	class JT_Register : public Task
+	class IRIS_EXPORT JT_Register : public Task
 	{
 		Q_OBJECT
 	public:
@@ -60,7 +60,7 @@
 		Private *d;
 	};
 
-	class JT_UnRegister : public Task
+	class IRIS_EXPORT JT_UnRegister : public Task
 	{
 		Q_OBJECT
 	public:
@@ -80,7 +80,7 @@
 		Private *d;
 	};
 
-	class JT_Roster : public Task
+	class IRIS_EXPORT JT_Roster : public Task
 	{
 		Q_OBJECT
 	public:
@@ -108,7 +108,7 @@
 		Private *d;
 	};
 
-	class JT_PushRoster : public Task
+	class IRIS_EXPORT JT_PushRoster : public Task
 	{
 		Q_OBJECT
 	public:
@@ -125,7 +125,7 @@
 		Private *d;
 	};
 
-	class JT_Presence : public Task
+	class IRIS_EXPORT JT_Presence : public Task
 	{
 		Q_OBJECT
 	public:
@@ -146,7 +146,7 @@
 		Private *d;
 	};
 
-	class JT_PushPresence : public Task
+	class IRIS_EXPORT JT_PushPresence : public Task
 	{
 		Q_OBJECT
 	public:
@@ -172,7 +172,7 @@
 		bool take(const QDomElement&);
 	};
 
-	class JT_Message : public Task
+	class IRIS_EXPORT JT_Message : public Task
 	{
 		Q_OBJECT
 	public:
@@ -188,7 +188,7 @@
 		Private *d;
 	};
 
-	class JT_PushMessage : public Task
+	class IRIS_EXPORT JT_PushMessage : public Task
 	{
 		Q_OBJECT
 	public:
@@ -205,7 +205,30 @@
 		Private *d;
 	};
 
-	class JT_GetServices : public Task
+	class IRIS_EXPORT JT_GetLastActivity : public Task
+	{
+		Q_OBJECT
+	public:
+		JT_GetLastActivity(Task *);
+		~JT_GetLastActivity();
+
+		void get(const Jid &);
+
+		int seconds() const;
+		const QString &message() const;
+
+		void onGo();
+		bool take(const QDomElement &x);
+
+	private:
+		class Private;
+		Private *d;
+
+		QDomElement iq;
+		Jid jid;
+	};
+
+	class IRIS_EXPORT JT_GetServices : public Task
 	{
 		Q_OBJECT
 	public:
@@ -227,7 +250,7 @@
 		AgentList agentList;
 	};
 
-	class JT_VCard : public Task
+	class IRIS_EXPORT JT_VCard : public Task
 	{
 		Q_OBJECT
 	public:
@@ -250,7 +273,7 @@
 		Private *d;
 	};
 
-	class JT_Search : public Task
+	class IRIS_EXPORT JT_Search : public Task
 	{
 		Q_OBJECT
 	public:
@@ -274,7 +297,7 @@
 		Private *d;
 	};
 
-	class JT_ClientVersion : public Task
+	class IRIS_EXPORT JT_ClientVersion : public Task
 	{
 		Q_OBJECT
 	public:
@@ -313,7 +336,7 @@
 		QDomElement iq;
 	};
 */
-	class JT_ServInfo : public Task
+	class IRIS_EXPORT JT_ServInfo : public Task
 	{
 		Q_OBJECT
 	public:
@@ -323,7 +346,7 @@
 		bool take(const QDomElement &);
 	};
 
-	class JT_Gateway : public Task
+	class IRIS_EXPORT JT_Gateway : public Task
 	{
 		Q_OBJECT
 	public:
@@ -346,7 +369,7 @@
 		QString v_prompt, v_desc;
 	};
 
-	class JT_Browse : public Task
+	class IRIS_EXPORT JT_Browse : public Task
 	{
 		Q_OBJECT
 	public:
@@ -368,7 +391,7 @@
 		AgentItem browseHelper (const QDomElement &i);
 	};
 
-	class JT_DiscoItems : public Task
+	class IRIS_EXPORT JT_DiscoItems : public Task
 	{
 		Q_OBJECT
 	public:
@@ -388,7 +411,7 @@
 		Private *d;
 	};
 
-	class JT_DiscoInfo : public Task
+	class IRIS_EXPORT JT_DiscoInfo : public Task
 	{
 		Q_OBJECT
 	public:
@@ -410,7 +433,7 @@
 		Private *d;
 	};
 
-	class JT_DiscoPublish : public Task
+	class IRIS_EXPORT JT_DiscoPublish : public Task
 	{
 		Q_OBJECT
 	public:
@@ -426,6 +449,27 @@
 		class Private;
 		Private *d;
 	};
+    
+	class JT_PrivateStorage : public Task
+	{
+		Q_OBJECT
+	public:
+		JT_PrivateStorage(Task *parent);
+		~JT_PrivateStorage();
+
+		void set(const QDomElement &);
+		void get(const QString &tag, const QString& xmlns);
+		
+		QDomElement element();
+
+		void onGo();
+		bool take(const QDomElement &);
+		
+	private:
+		class Private;
+		Private *d;
+	};
+	
 }
 
 #endif
Only in iris/xmpp-im/: xmpp_tasks.h.rej
Only in iris/xmpp-im/: xmpp_tasks.h~
diff -u /home/kde4/psi/psi/iris/xmpp-im/xmpp_vcard.h iris/xmpp-im/xmpp_vcard.h
--- /home/kde4/psi/psi/iris/xmpp-im/xmpp_vcard.h	2006-07-31 15:48:45.000000000 +0200
+++ iris/xmpp-im/xmpp_vcard.h	2006-07-31 17:42:45.000000000 +0200
@@ -28,11 +28,13 @@
 #include <QList>
 #include <qdom.h>
 
+#include <iris_export.h>
+
 class QDate;
 
 namespace XMPP
 {
-	class VCard
+	class IRIS_EXPORT VCard
 	{
 	public:
 		VCard();
@@ -85,7 +87,7 @@
 		void setBdayStr(const QString &);
 
 
-		class Address {
+		class IRIS_EXPORT Address {
 		public:
 			Address();
 
@@ -111,7 +113,7 @@
 		const AddressList &addressList() const;
 		void setAddressList(const AddressList &);
 
-		class Label {
+		class IRIS_EXPORT Label {
 		public:
 			Label();
 
@@ -132,7 +134,7 @@
 		void setLabelList(const LabelList &);
 
 
-		class Phone {
+		class IRIS_EXPORT Phone {
 		public:
 			Phone();
 
@@ -157,7 +159,7 @@
 		void setPhoneList(const PhoneList &);
 
 
-		class Email {
+		class IRIS_EXPORT Email {
 		public:
 			Email();
 
@@ -183,7 +185,7 @@
 		void setTimezone(const QString &);
 
 
-		class Geo {
+		class IRIS_EXPORT Geo {
 		public:
 			Geo();
 
@@ -215,7 +217,7 @@
 		void setAgentURI(const QString &);
 
 
-		class Org {
+		class IRIS_EXPORT Org {
 		public:
 			Org();
 
Only in iris/xmpp-core/: .svn
Only in iris/xmpp-core/: CMakeLists.txt
diff -u /home/kde4/psi/psi/iris/xmpp-core/connector.cpp iris/xmpp-core/connector.cpp
--- /home/kde4/psi/psi/iris/xmpp-core/connector.cpp	2006-07-31 15:48:57.000000000 +0200
+++ iris/xmpp-core/connector.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -718,3 +718,5 @@
 {
 	httpSyncFinished();
 }
+
+#include "connector.moc"
Only in iris/xmpp-core/: connector.cpp~
Only in iris/xmpp-core/: hash.cpp
Only in iris/xmpp-core/: hash.h
diff -u /home/kde4/psi/psi/iris/xmpp-core/jid.cpp iris/xmpp-core/jid.cpp
--- /home/kde4/psi/psi/iris/xmpp-core/jid.cpp	2006-07-31 15:48:43.000000000 +0200
+++ iris/xmpp-core/jid.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -238,6 +238,9 @@
 		b = d;
 	else
 		b = n + '@' + d;
+	
+	b=b.toLower(); // JID are not case sensitive
+	
 	if(r.isEmpty())
 		f = b;
 	else
@@ -409,3 +412,5 @@
 	return true;*/
 	return StringPrepCache::resourceprep(s, 1024, norm);
 }
+
+#include "jid.moc"
Only in iris/xmpp-core/: jid.cpp~
diff -u /home/kde4/psi/psi/iris/xmpp-core/protocol.h iris/xmpp-core/protocol.h
--- /home/kde4/psi/psi/iris/xmpp-core/protocol.h	2006-07-31 15:49:01.000000000 +0200
+++ iris/xmpp-core/protocol.h	2006-07-31 17:40:47.000000000 +0200
@@ -37,6 +37,7 @@
 #define NS_SESSION  "urn:ietf:params:xml:ns:xmpp-session"
 #define NS_STANZAS  "urn:ietf:params:xml:ns:xmpp-stanzas"
 #define NS_BIND     "urn:ietf:params:xml:ns:xmpp-bind"
+#define NS_CHATSTATES "http://jabber.org/protocol/chatstates"
 
 namespace XMPP
 {
Only in iris/xmpp-core/: protocol.h.rej
Only in iris/xmpp-core/: protocol.h~
Only in iris/xmpp-core/: qcaprovider.h
diff -u /home/kde4/psi/psi/iris/xmpp-core/securestream.cpp iris/xmpp-core/securestream.cpp
--- /home/kde4/psi/psi/iris/xmpp-core/securestream.cpp	2006-07-31 15:49:01.000000000 +0200
+++ iris/xmpp-core/securestream.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -307,8 +307,6 @@
 #endif
 };
 
-#include "securestream.moc"
-
 class SecureStream::Private
 {
 public:
@@ -590,3 +588,5 @@
 	if(bytesAvailable())
 		readyRead();
 }
+
+#include "securestream.moc"
Only in iris/xmpp-core/: securestream.cpp~
diff -u /home/kde4/psi/psi/iris/xmpp-core/stream.cpp iris/xmpp-core/stream.cpp
--- /home/kde4/psi/psi/iris/xmpp-core/stream.cpp	2006-07-31 15:49:03.000000000 +0200
+++ iris/xmpp-core/stream.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -1956,3 +1956,5 @@
 		debug_ptr->incomingXml(e);
 }
 #endif
+
+#include "stream.moc"
Only in iris/xmpp-core/: stream.cpp~
diff -u /home/kde4/psi/psi/iris/xmpp-core/tlshandler.cpp iris/xmpp-core/tlshandler.cpp
--- /home/kde4/psi/psi/iris/xmpp-core/tlshandler.cpp	2006-07-31 15:48:41.000000000 +0200
+++ iris/xmpp-core/tlshandler.cpp	2006-07-31 17:42:00.000000000 +0200
@@ -137,3 +137,5 @@
 	d->state = 0;
 	fail();
 }
+
+#include "tlshandler.moc"
Only in cutestuff/network/: .svn
Only in cutestuff/network/: CMakeLists.txt
diff -u /home/kde4/psi/psi/cutestuff/network/bsocket.cpp cutestuff/network/bsocket.cpp
--- /home/kde4/psi/psi/cutestuff/network/bsocket.cpp	2006-07-31 15:48:42.000000000 +0200
+++ cutestuff/network/bsocket.cpp	2006-07-31 17:42:11.000000000 +0200
@@ -388,3 +388,5 @@
 }
 
 // CS_NAMESPACE_END
+
+#include "bsocket.moc"
diff -u /home/kde4/psi/psi/cutestuff/network/bsocket.h cutestuff/network/bsocket.h
--- /home/kde4/psi/psi/cutestuff/network/bsocket.h	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/bsocket.h	2006-07-31 17:42:45.000000000 +0200
@@ -25,9 +25,10 @@
 #include <qhostaddress.h>
 #include "bytestream.h"
 
+#include <cutestuff_export.h>
 // CS_NAMESPACE_BEGIN
 
-class BSocket : public ByteStream
+class CUTESTUFF_EXPORT BSocket : public ByteStream
 {
 	Q_OBJECT
 public:
diff -u /home/kde4/psi/psi/cutestuff/network/httpconnect.cpp cutestuff/network/httpconnect.cpp
--- /home/kde4/psi/psi/cutestuff/network/httpconnect.cpp	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/httpconnect.cpp	2006-07-31 17:42:11.000000000 +0200
@@ -366,3 +366,5 @@
 }
 
 // CS_NAMESPACE_END
+
+#include "httpconnect.moc"
diff -u /home/kde4/psi/psi/cutestuff/network/httpconnect.h cutestuff/network/httpconnect.h
--- /home/kde4/psi/psi/cutestuff/network/httpconnect.h	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/httpconnect.h	2006-07-31 17:42:45.000000000 +0200
@@ -23,9 +23,10 @@
 
 #include "bytestream.h"
 
+#include <cutestuff_export.h>
 // CS_NAMESPACE_BEGIN
 
-class HttpConnect : public ByteStream
+class CUTESTUFF_EXPORT HttpConnect : public ByteStream
 {
 	Q_OBJECT
 public:
diff -u /home/kde4/psi/psi/cutestuff/network/httppoll.cpp cutestuff/network/httppoll.cpp
--- /home/kde4/psi/psi/cutestuff/network/httppoll.cpp	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/httppoll.cpp	2006-07-31 17:42:11.000000000 +0200
@@ -662,3 +662,5 @@
 }
 
 // CS_NAMESPACE_END
+
+#include "httppoll.moc"
diff -u /home/kde4/psi/psi/cutestuff/network/httppoll.h cutestuff/network/httppoll.h
--- /home/kde4/psi/psi/cutestuff/network/httppoll.h	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/httppoll.h	2006-07-31 17:42:53.000000000 +0200
@@ -23,9 +23,10 @@
 
 #include "bytestream.h"
 
+#include <cutestuff_export.h>
 // CS_NAMESPACE_BEGIN
 
-class HttpPoll : public ByteStream
+class CUTESTUFF_EXPORT HttpPoll : public ByteStream
 {
 	Q_OBJECT
 public:
@@ -67,7 +68,7 @@
 	const QString & getKey(bool *);
 };
 
-class HttpProxyPost : public QObject
+class CUTESTUFF_EXPORT HttpProxyPost : public QObject
 {
 	Q_OBJECT
 public:
Only in cutestuff/network/: ndns.cpp
Only in cutestuff/network/: ndns.cpp.rej
Only in cutestuff/network/: ndns.h
Only in cutestuff/network/: ndns.h.rej
Only in cutestuff/network/: servsock.cpp
Only in cutestuff/network/: servsock.cpp.rej
Only in cutestuff/network/: servsock.h
Only in cutestuff/network/: servsock.h.rej
diff -u /home/kde4/psi/psi/cutestuff/network/socks.cpp cutestuff/network/socks.cpp
--- /home/kde4/psi/psi/cutestuff/network/socks.cpp	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/socks.cpp	2006-07-31 17:42:11.000000000 +0200
@@ -1221,3 +1221,5 @@
 }
 
 // CS_NAMESPACE_END
+
+#include "socks.moc"
diff -u /home/kde4/psi/psi/cutestuff/network/socks.h cutestuff/network/socks.h
--- /home/kde4/psi/psi/cutestuff/network/socks.h	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/network/socks.h	2006-07-31 17:42:53.000000000 +0200
@@ -23,13 +23,14 @@
 
 #include "bytestream.h"
 
+#include <cutestuff_export.h>
 // CS_NAMESPACE_BEGIN
 
 class QHostAddress;
 class SocksClient;
 class SocksServer;
 
-class SocksUDP : public QObject
+class CUTESTUFF_EXPORT SocksUDP : public QObject
 {
 	Q_OBJECT
 public:
@@ -52,7 +53,7 @@
 	SocksUDP(SocksClient *sc, const QString &host, int port, const QHostAddress &routeAddr, int routePort);
 };
 
-class SocksClient : public ByteStream
+class CUTESTUFF_EXPORT SocksClient : public ByteStream
 {
 	Q_OBJECT
 public:
@@ -125,7 +126,7 @@
 	void writeData(const QByteArray &a);
 };
 
-class SocksServer : public QObject
+class CUTESTUFF_EXPORT SocksServer : public QObject
 {
 	Q_OBJECT
 public:
Only in cutestuff/network/: srvresolver.cpp
Only in cutestuff/network/: srvresolver.cpp.rej
Only in cutestuff/network/: srvresolver.h
Only in cutestuff/network/: srvresolver.h.rej
Only in cutestuff/util/: .svn
Only in cutestuff/util/: CMakeLists.txt
Only in cutestuff/util/: TODO
Only in cutestuff/util/: base64.cpp
Only in cutestuff/util/: base64.h
Only in cutestuff/util/: base64.h.rej
diff -u /home/kde4/psi/psi/cutestuff/util/bytestream.cpp cutestuff/util/bytestream.cpp
--- /home/kde4/psi/psi/cutestuff/util/bytestream.cpp	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/util/bytestream.cpp	2006-07-31 17:42:18.000000000 +0200
@@ -267,3 +267,5 @@
 //! error is indicated by \a code.
 
 // CS_NAMESPACE_END
+
+#include "bytestream.moc"
diff -u /home/kde4/psi/psi/cutestuff/util/bytestream.h cutestuff/util/bytestream.h
--- /home/kde4/psi/psi/cutestuff/util/bytestream.h	2006-07-31 15:48:41.000000000 +0200
+++ cutestuff/util/bytestream.h	2006-07-31 17:42:53.000000000 +0200
@@ -24,10 +24,11 @@
 #include <qobject.h>
 #include <q3cstring.h>
 
+#include <cutestuff_export.h>
 // CS_NAMESPACE_BEGIN
 
 // CS_EXPORT_BEGIN
-class ByteStream : public QObject
+class CUTESTUFF_EXPORT ByteStream : public QObject
 {
 	Q_OBJECT
 public:
Only in cutestuff/util/: cipher.cpp
Only in cutestuff/util/: cipher.h
Only in cutestuff/util/: qrandom.cpp
Only in cutestuff/util/: qrandom.h
Only in cutestuff/util/: safedelete.cpp
Only in cutestuff/util/: safedelete.cpp.rej
Only in cutestuff/util/: safedelete.h
Only in cutestuff/util/: sha1.cpp
Only in cutestuff/util/: sha1.h
Only in cutestuff/util/: sha1.h.rej
Only in cutestuff/util/: showtextdlg.cpp
Only in cutestuff/util/: showtextdlg.h
